[{"index"=>"incoming_documents_production_db_core_cards_incoming_documents_cards", "search_type"=>"count"}, {"query"=>{"filtered"=>{"filter"=>{"bool"=>{"must"=>[[{"range"=>{"created_at"=>{"gte"=>"2015-01-01", "lte"=>"2016-01-01"}}}, {"term"=>{"provider_id"=>"565c6f39c0d0000003000001"}}], [{"bool"=>{"must"=>[{"bool"=>{"must"=>[{"term"=>{"is_registered"=>"true"}}]}}]}}], [{"bool"=>{"must"=>[{"bool"=>{"must"=>[{"term"=>{"decisions.comment"=>""}}]}}]}}]]}}}}}, {"index"=>"incoming_documents_production_db_core_cards_incoming_documents_cards", "search_type"=>"count"}, {"query"=>{"filtered"=>{"filter"=>{"bool"=>{"must"=>[[{"range"=>{"created_at"=>{"gte"=>"2015-01-01", "lte"=>"2016-01-01"}}}, {"term"=>{"provider_id"=>"565c6f39c0d0000003000001"}}], [{"bool"=>{"must"=>[{"bool"=>{"must"=>[{"term"=>{"is_registered"=>"true"}}]}}]}}], [{"bool"=>{"must"=>[{"bool"=>{"must"=>[{"script"=>{"script"=>"import java.text.SimpleDateFormat;def sdf = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss'Z'\\\");sdf.setTimeZone(TimeZone.getTimeZone(\\\"GMT\\\"));def start_date = sdf.parse('2015-01-01T00:00:00Z');def end_date = sdf.parse('2016-12-31T00:00:00Z');def controls = _source['controls'];for(control in controls){    def logs = control.logs;    for(log in logs){        if (log.event == 'opened'){            def log_date = sdf.parse(log.date);            if (log_date > start_date && log_date < end_date) return true;        };    };};return false;"}}]}}]}}]]}}}}}]