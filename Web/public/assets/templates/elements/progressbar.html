<template id="progressbar">
  
  <style> @import "assets/css/mui.css"; </style>
  <style> @import "assets/css/elements/progressbar.css"; </style>
  <style> @import "assets/css/animate.css"; </style>

  <div class="mui--z1 core-progressbar">
    <div class="bar animated percent"></div>
  </div>

</template>

<script>
window.onload = (function( window, document, undefined) {
  var thatDoc              = document,
      thisDoc              = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument,
      itemTemplate         = thisDoc.querySelector('template#progressbar').content,
      CoreProgressbarProto = Object.create(HTMLElement.prototype);
  
  CoreProgressbarProto.createdCallback = function(){
    this.initialize();
  };

  CoreProgressbarProto.attributeChangedCallback = function( attr, oldVal, newVal) {
    switch( attr ){
      case 'percent':
        // console.log('percent changed');
        this.setPercent( newVal, oldVal );
        break;
      default:
        console.log('UNEXPECTED attr, oldVal, newVal: ',attr, oldVal, newVal);
        break;

    };
  };
  CoreProgressbarProto.create = function() {
    console.log('** core-progressbar :: create');

    var shadowRoot = this.createShadowRoot(),
        item = thatDoc.importNode(itemTemplate, true);
    shadowRoot.appendChild(item);

    this.root = shadowRoot;
    this.bar  = shadowRoot.querySelector('.bar');
  };

  CoreProgressbarProto.initialize = function(){
    this.percent = this.getAttribute('percent') || 0;
    this.root = {};
    this.bar  = {};

    console.log( '** core-progressbar :: initialize', this);
    this.create();

  };

  CoreProgressbarProto.setPercent = function(newPercent, oldPercent){
    this.percent = newPercent;
    this.bar.classList.toggle( 'percent-' + newPercent);
    this.bar.classList.toggle( 'percent-' + oldPercent);
  };


  window.CoreSelect = thatDoc.registerElement('core-progressbar', {
    prototype: CoreProgressbarProto
  });

})(window, document);
</script>