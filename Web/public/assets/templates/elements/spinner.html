<template id="core-spinner">
  <style> @import "assets/css/css/mdl.css"; </style>
  
  <div class="core-spinner mdl-spinner mdl-js-spinner is-active">
  </div>

</template>

<script>
window.onload = (function( window, document, undefined) {
  var thatDoc      = document,
      thisDoc      = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument,
      itemTemplate = thisDoc.querySelector('template#core-spinner').content,
      SpinnerProto  = Object.create(HTMLElement.prototype);

  SpinnerProto.Constant_ = {
    MDL_SPINNER_LAYER_COUNT: 4
  };

  SpinnerProto.CssClasses_ = {
    MDL_SPINNER_LAYER          : 'mdl-spinner__layer',
    MDL_SPINNER_CIRCLE_CLIPPER : 'mdl-spinner__circle-clipper',
    MDL_SPINNER_CIRCLE         : 'mdl-spinner__circle',
    MDL_SPINNER_GAP_PATCH      : 'mdl-spinner__gap-patch',
    MDL_SPINNER_LEFT           : 'mdl-spinner__left',
    MDL_SPINNER_RIGHT          : 'mdl-spinner__right'
  };

  SpinnerProto.createLayer = function(index) {
    var layer = document.createElement('div');
    layer.classList.add(this.CssClasses_.MDL_SPINNER_LAYER);
    layer.classList.add(this.CssClasses_.MDL_SPINNER_LAYER + '-' + index);

    var leftClipper = document.createElement('div');
    leftClipper.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE_CLIPPER);
    leftClipper.classList.add(this.CssClasses_.MDL_SPINNER_LEFT);

    var gapPatch = document.createElement('div');
    gapPatch.classList.add(this.CssClasses_.MDL_SPINNER_GAP_PATCH);

    var rightClipper = document.createElement('div');
    rightClipper.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE_CLIPPER);
    rightClipper.classList.add(this.CssClasses_.MDL_SPINNER_RIGHT);

    var circleOwners = [leftClipper, gapPatch, rightClipper];

    for (var i = 0; i < circleOwners.length; i++) {
      var circle = document.createElement('div');
      circle.classList.add(this.CssClasses_.MDL_SPINNER_CIRCLE);
      circleOwners[i].appendChild(circle);
    }

    layer.appendChild(leftClipper);
    layer.appendChild(gapPatch);
    layer.appendChild(rightClipper);

    this.element_.appendChild(layer);
  };

  SpinnerProto.stop = function() {
    this.element_.classList.remove('is-active');
  };

  SpinnerProto.start = function() {
    this.element_.classList.add('is-active');
  };

  SpinnerProto.init = function() {
    if (this.element_) {
      for (var i = 1; i <= this.Constant_.MDL_SPINNER_LAYER_COUNT; i++) {
        this.createLayer(i);
      }

      this.element_.classList.add('is-upgraded');
    }
  };



  SpinnerProto.createdCallback = function(){
    this.initialize();
  };

  SpinnerProto.attributeChangedCallback = function( attr, oldVal, newVal) {
    switch( attr ){
      default:
        console.log('UNEXPECTED attr, oldVal, newVal: ',attr, oldVal, newVal);
        break;
    };
  };

  SpinnerProto.create = function() {
    console.log('** core-spinner :: create');

    var shadowRoot = this.createShadowRoot(),
        item       = thatDoc.importNode( itemTemplate, true );
    shadowRoot.appendChild( item );

    this.root     = shadowRoot;
    this.element_ = this.root.querySelector('.core-spinner');
  };

  SpinnerProto.addElement = function( element ){
    console.log( this.application, this.application.content, element );
    this.application.addElement( element );
  };
  
  SpinnerProto.removeElement = function(element){
    this.application.removeElement( element );
  };

  SpinnerProto.updateProgress = function(percent){
    this.application.updateProgress( percent );
  };


  SpinnerProto.initialize = function(){
    console.log( '** core-spinner :: initialize', this);

    this.root     = {};
    this.element_ = {};

    this.create();
    this.init();

  };

  window.CoreSelect = thatDoc.registerElement('core-spinner', {
    prototype: SpinnerProto
  });

})(window, document);
</script>