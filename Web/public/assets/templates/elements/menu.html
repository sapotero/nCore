<template id="core-menu">

  <style> @import "assets/css/css/mdl.css"; </style>
  <style> @import "assets/css/css/font.css"; </style>
  <style> @import "assets/css/elements/menu.css"; </style>
  <style> @import "assets/css/animate.css"; </style>

  <ul class="panel menu-list mdl-list mdl-cell--hide-phone">
  </ul>

</template>

<script>
window.onload = (function( window, document, undefined) {
  var thatDoc      = document,
      thisDoc      = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument,
      itemTemplate = thisDoc.querySelector('template#core-menu').content,
      MenuProto    = Object.create(HTMLElement.prototype);
  
  MenuProto.createdCallback = function(){
    this.initialize();
  };


  MenuProto.addElement = function( element ){
    this[ element ] = document.createElement( 'core-' + element );
    this.application.appendChild( this[ element ] );
  };
  MenuProto.removeElement = function(element){
    this[ element ].remove()
    delete this[ element ];
  };
  MenuProto.setShadow = function (depth) {
     this.menu.classList.add('mdl-shadow--' + depth + 'dp')
  }

  MenuProto.attributeChangedCallback = function( attr, oldVal, newVal) {
    switch( attr ){
      case "shadow":
        this.setShadow( newVal );
        break;
      default:
        console.log('UNEXPECTED attr, oldVal, newVal: ',attr, oldVal, newVal);
        break;
    };
  };
  MenuProto.create = function() {
    console.log('** core-menu :: create');

    var shadowRoot = this.createShadowRoot(),
        item       = thatDoc.importNode( itemTemplate, true );
    shadowRoot.appendChild( item );

    this.root = shadowRoot;
    this.menu = this.root.querySelector('.menu-list');
  };

  MenuProto.add = function( config ) {
    console.log( '** core-menu :: add', config );

    var element = document.createElement('li');
    element.className = "menu-item mdl-list__item";
    element.innerHTML = this.menuItemProto;
    if ( config.name ) {
      element.querySelector('.document-name').textContent = config.name;
    }
    if ( config.icon ) {
      element.querySelector('.mdl-list__item-avatar').textContent = config.icon;
    }
    if ( config.action ) {
      element.setAttribute('action', config.action);
    }
    if ( config.count ) {
      element.classList.add('mdl-list__item--two-line');
      element.querySelector('.mdl-list__item-sub-title').textContent = config.count;
    } else {
      element.classList.add('mdl-list__item--one-line');
    }
    
    this.menu.appendChild( element );
    
    var elements = this.elements;
    
    element.addEventListener( 'click', function (event) {
      console.log( 'menu -> click', this );
      
      for(var i = 0, length1 = elements.length; i < length1; i++){
        var _element = elements[i];

        _element.classList.remove('mdl-color--grey-200');
        
        if ( this == _element) {
          _element.classList.add('mdl-color--grey-200');
          core.events.publish( 'core:reports:menu:select', _element );
        }
      };

    });

    this.elements.push( element );

  };

  MenuProto.initialize = function(){
    console.log( '** core-menu :: initialize', this);

    this.root     = {};
    this.menu     = {};
    this.elements = [];

    this.menuItemProto = `
      <span class="mdl-list__item-primary-content">
        <i class="material-icons mdl-list__item-avatar"></i>
        <span class="document-name"></span>
        <span class="mdl-list__item-sub-title"></span>
      </span>`;
    this.create();
    // this.default();
  };
  
  MenuProto.default = function(){
    var defaultMenu = [
      {
        "icon"   : "folder",
        "name"   : "Мои документы",
        "count"  : "100 документов",
        "action" : "my"
      },
      {
        "icon"   : "folder_shared",
        "name"   : "Общие документы",
        "count"  : "100 документов",
        "action" : "shared"
      },
      {
        "icon"   : "person",
        "name"   : "Шаблоны",
        "action" : "templates"
      }
    ];

    for(var i = 0, length1 = defaultMenu.length; i < length1; i++){
      this.add( defaultMenu[i] );
    }
  };

  window.CoreSelect = thatDoc.registerElement('core-menu', {
    prototype: MenuProto
  });

})(window, document);
</script>