<template id="core-card">

  <style> @import "assets/css/css/mdl.css"; </style>
  <style> @import "assets/css/css/font.css"; </style>
  <style> @import "assets/css/elements/card.css"; </style>
  <style> @import "assets/css/animate.css"; </style>
  
  <div class="report-card-full mdl-cell mdl-cell--3-col mdl-cell--12-col-phone mdl-card">
    <div class="report-card mdl-card--border mdl-shadow--2dp">

      <div class="mdl-card__title mdl-card--expand">
        <h4 class="mdl-card__title-text"></h4>
        <div class="mdl-card__subtitle-text">
        </div>
      </div>

      <div class="mdl-card__supporting-text">
        document name
      </div>

      <div class="mdl-card__actions mdl-card--border">
        <!-- <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
          Добавить
        </a>
        <div class="mdl-layout-spacer"></div>
        <i class="material-icons">event</i> -->
        <div class="mdl-card__supporting-text mdl-card__supporting-text-date"> date current </div>
      </div>


      <div class="mdl-card__menu mdl-card__menu-hide">
        <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
          <i class="material-icons">star</i>
        </button>
      </div>

    </div>
  </div>
</template>

<script>
window.onload = (function( window, document, undefined) {
  var thatDoc      = document,
      thisDoc      = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument,
      itemTemplate = thisDoc.querySelector('template#core-card').content,
      CardProto  = Object.create(HTMLElement.prototype);
  
  CardProto.createdCallback = function(){
    this.initialize();
    this.bindEvents();
  };

  CardProto.attributeChangedCallback = function( attr, oldVal, newVal) {
    switch( attr ){
      case 'id':
        // console.log('ID attr, oldVal, newVal: ',attr, oldVal, newVal);
        this.setId( newVal );
        break;
      case 'template':
        // console.log('ID attr, oldVal, newVal: ',attr, oldVal, newVal);
        this.setTemplate( !!newVal );
        break;
      case 'update':
        // console.log('ID attr, oldVal, newVal: ',attr, oldVal, newVal);
        this.setUpdated( newVal );
        break;
      case 'name':
        // console.log('ID attr, oldVal, newVal: ',attr, oldVal, newVal);
        this.setName( newVal );
        break;
      default:
        console.log('UNEXPECTED attr, oldVal, newVal: ',attr, oldVal, newVal);
        break;
    };
  };

  CardProto.create = function() {
    // console.log('** core-card :: create');

    var shadowRoot = this.createShadowRoot(),
        item       = thatDoc.importNode( itemTemplate, true );
    shadowRoot.appendChild( item );

    this.root   = shadowRoot;
    this.layout = this.root.querySelector('.mdl-card');
  };

  CardProto.initialize = function(){
    // console.log( '** core-card :: initialize', this);
    this.root       = {};
    this.layout     = {};
    
    this.id         = this.getAttribute('id');
    this.isTemplate = false;
    this.name       = "";
    this.updated    = {};

    this.create();
  };

  CardProto.show = function(event){
    core.events.publish( 'core:router:reports:show', { id: this.id, name: this.name } );
  };

  CardProto.setId = function(id) {
    this.id = id;
  };
  CardProto.setUpdated = function(updated) {
    this.updated = updated;

    this.layout.querySelector('.mdl-card__supporting-text-date').textContent = new Date(Date.parse( this.updated )).toLocaleString();
  };

  CardProto.setName = function(name) {
    this.name = name;
    this.layout.querySelector('.mdl-card__supporting-text').textContent = this.name;
  };
  
  CardProto.setTemplate = function(bool) {
    this.isTemplate = bool;
    this.layout.querySelector('.mdl-card__menu').classList.remove('mdl-card__menu-hide');
  };

  CardProto.bindEvents = function() {
    this.layout.addEventListener( 'click', this.show.bind(this) );
  };

  window.CoreSelect = thatDoc.registerElement('core-card', {
    prototype: CardProto
  });

})(window, document);
</script>